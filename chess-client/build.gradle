/*
 * This file was generated by the Gradle 'init' task.
 */

plugins {
    id 'com.pmarshall.java-conventions'
    id 'org.openjfx.javafxplugin' version '0.1.0'
    id 'org.panteleyev.jpackageplugin' version '1.5.2'
}

dependencies {
    api project(':chess-model')
    api project(':chess-engine')
    api project(':chess-web-api')
    api 'org.openjfx:javafx:17.0.6'
    api 'org.openjfx:javafx-fxml:17.0.6'
    api 'org.openjfx:javafx-controls:17.0.6'
    api 'org.slf4j:slf4j-api:2.0.6'
    api 'org.slf4j:slf4j-simple:2.0.6'
}

javafx {
    version = '17'
    modules = ['javafx.controls', 'javafx.fxml']
}

task copyDependencies(type: Copy) {
    from(configurations.runtimeClasspath)
    into("$buildDir/deps")
}

task copyJar(type: Copy) {
    from(tasks.jar)
    into("$buildDir/deps")
}

tasks.jpackage {
    dependsOn("build", "copyDependencies", "copyJar")

    arguments = [System.getenv('SERVER_ADDRESS') == null ? '127.0.0.1:21370' : System.getenv('SERVER_ADDRESS')]
    appVersion = project.version.toString()
    module = "com.pmarshall.chessgame.client/com.pmarshall.chessgame.client.Main"
    modulePaths = ["$buildDir/deps"]
    addModules = ["org.slf4j.simple", "com.pmarshall.chessgame.engine"]
    destination = "$buildDir/dist"

    linux {
        appName = "linux-chess-client"
        icon = 'src/main/resources/icons/green-knight-icon.png'
        linuxShortcut = true
        linuxPackageName = "linux-chess-client"
    }

    windows {
        appName = "Windows Chess Client"
        icon = 'src/main/resources/icons/green-knight-icon.ico'
        winConsole = true
        winDirChooser = true
        winShortcut = true
    }
}

description = 'chess-client'
